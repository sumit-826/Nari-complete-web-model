<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NARI - AI Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body>

    <!-- Three.js Background Canvas -->
    <canvas id="bg-canvas"></canvas>

    <div id="main-container">
        <!-- Sidebar -->
        <aside id="sidebar"
            class="h-full glass-panel flex flex-col justify-between p-4 z-10 sidebar border-r border-white/5">
            <div>
                <button
                    class="w-full flex items-center gap-2 bg-slate-800/50 hover:bg-slate-700/50 text-white py-3 px-4 rounded-lg transition border border-white/5 mb-8">
                    <i class="fa-solid fa-plus text-sm"></i>
                    <span class="font-medium text-sm">New chat</span>
                </button>

                <div class="mb-4">
                    <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3 px-2">Recent</h3>
                    <div id="recent-chats" class="space-y-1">
                        <!-- Chat history items will be rendered here -->
                    </div>
                </div>
            </div>

            <div class="space-y-1">
                <div id="settings-btn"
                    class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-white/5 cursor-pointer transition text-slate-400 hover:text-white"
                    onclick="openSettings()">
                    <i class="fa-solid fa-gear text-xs"></i>
                    <span class="text-sm">Settings</span>
                </div>
                <div
                    class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-white/5 cursor-pointer transition text-slate-400 hover:text-white">
                    <div class="w-5 h-5 rounded-full bg-gradient-to-tr from-pink-500 to-orange-400"></div>
                    <span class="text-sm">User Profile</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative h-full overflow-hidden">
            <header class="h-16 flex items-center justify-between px-6 border-b border-white/5 glass-panel z-10">
                <div class="flex items-center gap-3">
                    <button id="sidebar-toggle"
                        class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition mr-2">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <img src="Assets/logo.png" alt="NARI Logo" class="w-8 h-8 rounded">
                    <span class="font-bold text-lg tracking-wide text-white">NARI</span>
                </div>
                <div class="flex items-center gap-4">
                    <button
                        class="w-8 h-8 rounded-full border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/5 transition">
                        <i class="fa-regular fa-circle-question"></i>
                    </button>
                </div>
            </header>

            <!-- Main Content Area (Chat + Info Panel) -->
            <div class="flex-1 flex flex-row overflow-hidden">
                <!-- Chat Container -->
                <div id="chat-container" class="flex-1 flex flex-col items-center relative p-6 overflow-y-auto">

                    <!-- Welcome/Start View -->
                    <div id="welcome-view" class="flex-1 flex flex-col items-center justify-center w-full">
                        <div class="orb-container mb-8">
                            <img src="Assets/logo.png" alt="NARI" class="w-full h-full object-contain orb-logo">
                        </div>

                        <div class="text-center mb-12 z-10">
                            <h1 id="greeting-text"
                                class="text-6xl font-bold mb-4 tracking-tight text-gradient drop-shadow-2xl font-script">
                                Good morning,
                                there</h1>
                            <p class="text-slate-400 text-lg font-light">How can I help you today?</p>
                        </div>

                        <div id="suggestions-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-3xl z-10">
                            <!-- Suggestions will be rendered here dynamically -->
                        </div>
                    </div>

                    <!-- Input Area (Fixed to bottom of chat-container or absolute) -->
                    <div class="w-full max-w-3xl mt-8 mb-4 input-wrapper relative group shrink-0">
                        <div
                            class="absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl blur opacity-20 group-hover:opacity-40 transition duration-500">
                        </div>
                        <div
                            class="relative flex items-center bg-slate-900/90 rounded-2xl border border-white/10 p-2 shadow-2xl">

                            <!-- Attachment Menu -->
                            <div id="attachment-menu" class="attachment-menu">
                                <div class="attachment-item" onclick="handleAttachment('doc')">
                                    <i class="fa-solid fa-file-lines text-blue-400"></i>
                                    <span class="text-sm">Document</span>
                                </div>
                                <div class="attachment-item" onclick="handleAttachment('image')">
                                    <i class="fa-solid fa-image text-emerald-400"></i>
                                    <span class="text-sm">Image</span>
                                </div>
                                <div class="attachment-item" onclick="handleAttachment('code')">
                                    <i class="fa-solid fa-code text-purple-400"></i>
                                    <span class="text-sm">Code</span>
                                </div>
                            </div>

                            <!-- Hidden File Inputs -->
                            <input type="file" id="doc-input" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                            <input type="file" id="image-input" accept="image/*" style="display: none;">
                            <input type="file" id="code-input" accept=".js,.py,.java,.cpp,.c,.html,.css,.json,.xml"
                                style="display: none;">

                            <button id="plus-btn"
                                class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition">
                                <i class="fa-solid fa-plus"></i>
                            </button>

                            <!-- Tool Toggle Buttons -->
                            <div class="flex items-center gap-1 px-2 border-r border-white/10">
                                <button id="web-search-toggle"
                                    class="tool-toggle flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs transition border"
                                    onclick="toggleTool('webSearch')" title="Enable Web Search (Tavily)">
                                    <i class="fa-solid fa-globe"></i>
                                    <span class="hidden sm:inline">Search</span>
                                </button>
                                <button id="stock-toggle"
                                    class="tool-toggle flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs transition border"
                                    onclick="toggleTool('stock')" title="Enable Stock Data (Alpha Vantage)">
                                    <i class="fa-solid fa-chart-line"></i>
                                    <span class="hidden sm:inline">Stock</span>
                                </button>
                            </div>

                            <input type="text" id="main-input" placeholder="Enter a prompt here"
                                class="flex-1 bg-transparent border-none outline-none text-white placeholder-slate-500 px-4 h-12">
                            <div class="flex items-center gap-2 pr-2">
                                <div class="relative">
                                    <button id="model-selector-btn"
                                        class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-slate-300 border border-white/5 transition">
                                        <span id="current-model">Fast</span> <i
                                            class="fa-solid fa-chevron-down text-[10px]"></i>
                                    </button>
                                    <div id="model-dropdown"
                                        class="absolute bottom-full right-0 mb-2 w-32 bg-slate-900 border border-white/10 rounded-lg shadow-xl hidden flex-col py-1 z-50">
                                        <button
                                            class="px-4 py-2 text-xs text-left text-slate-300 hover:bg-white/5 flex items-center justify-between"
                                            onclick="selectModel('Fast')">
                                            Fast <i class="fa-solid fa-check text-indigo-500 text-[10px] model-check"
                                                id="check-Fast"></i>
                                        </button>
                                        <button
                                            class="px-4 py-2 text-xs text-left text-slate-300 hover:bg-white/5 flex items-center justify-between"
                                            onclick="selectModel('Thinking')">
                                            Thinking <i
                                                class="fa-solid fa-check text-indigo-500 text-[10px] model-check hidden"
                                                id="check-Thinking"></i>
                                        </button>
                                    </div>
                                </div>
                                <button id="send-btn"
                                    class="w-10 h-10 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl shadow-lg shadow-indigo-500/30 transition transform active:scale-95">
                                    <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="text-center text-[10px] text-slate-600 mb-2">
                        NARI may display inaccurate info, including about people, so double-check its responses.
                    </div>
                </div>

                <!-- Info/Reasoning Panel (Initially Hidden) - RIGHT SIDE -->
                <aside id="info-panel"
                    class="hidden w-80 glass-panel border-l border-white/5 p-4 overflow-y-auto shrink-0 h-full">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-semibold text-white flex items-center gap-2">
                            <i class="fa-solid fa-brain text-indigo-400"></i>
                            Thinking Process
                        </h3>
                        <button onclick="document.getElementById('info-panel').classList.add('hidden')"
                            class="text-slate-400 hover:text-white transition">
                            <i class="fa-solid fa-xmark text-xs"></i>
                        </button>
                    </div>
                    <div id="hierarchy-tree" class="space-y-3">
                        <!-- Reasoning nodes will be rendered here dynamically -->
                    </div>
                </aside>
            </div> <!-- End of flex-row wrapper -->
        </main>

    </div>

    <script src="script.js"></script>
    <script src="background.js"></script>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeSettings()"></div>
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl max-h-[85vh] overflow-y-auto bg-slate-900 border border-white/10 rounded-2xl shadow-2xl">
            <!-- Header -->
            <div class="flex items-center justify-between p-5 border-b border-white/10">
                <h2 class="text-xl font-semibold text-white flex items-center gap-2">
                    <i class="fa-solid fa-gear text-indigo-400"></i> Settings
                </h2>
                <button onclick="closeSettings()" class="text-slate-400 hover:text-white transition">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>

            <!-- Settings Content -->
            <div class="p-5 space-y-6">

                <!-- Theme Section -->
                <div class="settings-section">
                    <h3 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-palette text-purple-400"></i> Appearance
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Theme</label>
                            <select id="setting-theme" class="settings-input">
                                <option value="dark">Dark Mode</option>
                                <option value="light">Light Mode</option>
                                <option value="system">System Default</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Accent Color</label>
                            <select id="setting-accent" class="settings-input">
                                <option value="indigo">Indigo</option>
                                <option value="purple">Purple</option>
                                <option value="blue">Blue</option>
                                <option value="emerald">Emerald</option>
                                <option value="rose">Rose</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- AI Model Section -->
                <div class="settings-section">
                    <h3 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-robot text-blue-400"></i> AI Configuration
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Default Model</label>
                            <select id="setting-model" class="settings-input">
                                <option value="Fast">Fast (qwen2.5)</option>
                                <option value="Thinking">Thinking Mode</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Temperature</label>
                            <input type="range" id="setting-temperature" min="0" max="2" step="0.1" value="0.7"
                                class="w-full accent-indigo-500">
                            <div class="flex justify-between text-[10px] text-slate-500">
                                <span>Precise</span>
                                <span id="temp-value">0.7</span>
                                <span>Creative</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="text-xs text-slate-400 mb-1 block">System Prompt</label>
                        <textarea id="setting-system-prompt" rows="3" class="settings-input resize-none"
                            placeholder="Custom instructions for the AI..."></textarea>
                    </div>
                </div>

                <!-- Chat Settings -->
                <div class="settings-section">
                    <h3 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-message text-emerald-400"></i> Chat Preferences
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="text-sm text-slate-300">Send with Enter key</span>
                            <input type="checkbox" id="setting-enter-send" checked class="settings-toggle">
                        </label>
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="text-sm text-slate-300">Sound effects</span>
                            <input type="checkbox" id="setting-sound" class="settings-toggle">
                        </label>
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="text-sm text-slate-300">Auto-enable web search</span>
                            <input type="checkbox" id="setting-auto-search" class="settings-toggle">
                        </label>
                        <label class="flex items-center justify-between cursor-pointer">
                            <span class="text-sm text-slate-300">Auto-enable stock tools</span>
                            <input type="checkbox" id="setting-auto-stock" class="settings-toggle">
                        </label>
                    </div>
                </div>

                <!-- API Settings -->
                <div class="settings-section">
                    <h3 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-plug text-orange-400"></i> API Configuration
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Backend URL</label>
                            <input type="text" id="setting-backend-url" value="http://localhost:5000"
                                class="settings-input" placeholder="http://localhost:5000">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Ollama URL</label>
                            <input type="text" id="setting-ollama-url" value="http://localhost:11434"
                                class="settings-input" placeholder="http://localhost:11434">
                        </div>
                    </div>
                    <button onclick="testConnection()"
                        class="mt-3 px-4 py-2 text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition flex items-center gap-2">
                        <i class="fa-solid fa-plug"></i> Test Connection
                    </button>
                    <div id="connection-status" class="mt-2 text-xs hidden"></div>
                </div>

                <!-- Data Management -->
                <div class="settings-section">
                    <h3 class="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-database text-red-400"></i> Data Management
                    </h3>
                    <div class="flex gap-3">
                        <button onclick="exportChats()"
                            class="px-4 py-2 text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition">
                            <i class="fa-solid fa-download mr-1"></i> Export Chats
                        </button>
                        <button onclick="clearAllChats()"
                            class="px-4 py-2 text-xs bg-red-900/50 hover:bg-red-800/50 text-red-300 rounded-lg transition">
                            <i class="fa-solid fa-trash mr-1"></i> Clear All Chats
                        </button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex items-center justify-between p-5 border-t border-white/10 bg-slate-900/50">
                <button onclick="resetSettings()" class="px-4 py-2 text-sm text-slate-400 hover:text-white transition">
                    Reset to Defaults
                </button>
                <div class="flex gap-3">
                    <button onclick="closeSettings()"
                        class="px-4 py-2 text-sm bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition">
                        Cancel
                    </button>
                    <button onclick="saveSettings()"
                        class="px-5 py-2 text-sm bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg transition">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>